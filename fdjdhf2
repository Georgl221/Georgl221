import matplotlib.pyplot as plt
import pandas as pd
import re
import july
import jieba
 
from july.utils import date_range
import seaborn as sns
from scipy.stats import norm
import numpy as np
 
from wordcloud import WordCloud
from collections import Counter
 
 
def set_chinese_font():
    # 设置中文字体
    plt.rcParams['font.sans-serif'] = ['SimHei']  # 设置中文字体为黑体
    plt.rcParams['axes.unicode_minus'] = False  # 用来正常显示负号
 
 
def read_chat_data(file_path):
    # 读取CSV文件
    df = pd.read_csv(file_path)
    return df
 
 
def preprocess_data(df):
    # 数据预处理
    df = df[df['Type'] == 1]  # 只保留文本聊天
    selected_columns = ['IsSender', 'StrContent', 'StrTime']
    df = df[selected_columns]  # 只取'IsSender','StrContent','StrTime'列
    df['StrTime'] = pd.to_datetime(df['StrTime'])
    df['Date'] = df['StrTime'].dt.date
    return df
 
 
def plot_chat_frequency_by_day(df):
    # 每天聊天频率柱状图
    chat_frequency = df['Date'].value_counts().sort_index()
    chat_frequency.plot(kind='bar', color='#DF9F9B')
    total_messages = len(df)
    date_labels = [date.strftime('%m-%d') for date in chat_frequency.index]
    plt.text(30, 1300, '消息总数：{0}条'.format(total_messages), ha='left', va='top', fontsize=10, color='black')
    plt.text(30, 1250, '起止时间：{0} --- {1}'.format(date_labels[0], date_labels[-1]), ha='left', va='top', fontsize=10,
             color='black')
    plt.xlabel('Date')
    plt.ylabel('Frequency')
    plt.title('Chat Frequency by Day')
    plt.xticks(range(1, len(date_labels), 7), date_labels[::7])
    plt.xticks(fontsize=5)
    plt.show()
 
 
def plot_calendar_heatmap(df):
    # 制作日历热力图
    df['Date'] = pd.to_datetime(df['Date'])
    start_date = df['Date'].min()
    end_date = df['Date'].max()
    dates = date_range(start_date, end_date)
    july.heatmap(dates=dates,
                 data=df['Date'].value_counts().sort_index(),
                 cmap='Pastel1',
                 month_grid=True,
                 horizontal=True,
                 value_label=False,
                 date_label=False,
                 weekday_label=True,
                 month_label=True,
                 year_label=True,
                 colorbar=False,
                 fontfamily="monospace",
                 fontsize=12,
                 title=None,
                 titlesize='large',
                 dpi=100)
    plt.tight_layout()
    plt.show()
 
 
